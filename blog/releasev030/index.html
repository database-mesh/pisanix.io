<!doctype html>
<html lang="zh" dir="ltr" class="blog-wrapper blog-post-page plugin-blog plugin-id-default">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.18">
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Pisanix RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Pisanix Atom Feed"><title data-rh="true">Pisanix v0.3.0 Released ! | Pisanix</title><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://www.pisanix.io/blog/releasev030"><meta data-rh="true" name="docusaurus_locale" content="zh"><meta data-rh="true" name="docusaurus_tag" content="default"><meta data-rh="true" name="docsearch:language" content="zh"><meta data-rh="true" name="docsearch:docusaurus_tag" content="default"><meta data-rh="true" property="og:title" content="Pisanix v0.3.0 Released ! | Pisanix"><meta data-rh="true" name="description" content="Database Mesh-oriented solutions for an easy-to-use, good-to-use, and practical user experience."><meta data-rh="true" property="og:description" content="Database Mesh-oriented solutions for an easy-to-use, good-to-use, and practical user experience."><meta data-rh="true" property="og:type" content="article"><meta data-rh="true" property="article:published_time" content="2022-09-29T00:00:00.000Z"><meta data-rh="true" property="article:author" content="https://github.com/mlycore,https://github.com/xuanyuan300,https://github.com/wbtlb"><meta data-rh="true" property="article:tag" content="pisanix,v0.3.0"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://www.pisanix.io/blog/releasev030"><link data-rh="true" rel="alternate" href="https://www.pisanix.io/en/blog/releasev030" hreflang="en"><link data-rh="true" rel="alternate" href="https://www.pisanix.io/blog/releasev030" hreflang="zh"><link data-rh="true" rel="alternate" href="https://www.pisanix.io/blog/releasev030" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.457fbd32.css">
<link rel="preload" href="/assets/js/runtime~main.04f15e4e.js" as="script">
<link rel="preload" href="/assets/js/main.0d539512.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region"><a href="#" class="skipToContent_ZgBM">Ë∑≥Âà∞‰∏ªË¶ÅÂÜÖÂÆπ</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.svg" alt="Pisanix Logo" class="themedImage_W2Cr themedImage--light_TfLj"><img src="/img/logo.svg" alt="Pisanix Logo" class="themedImage_W2Cr themedImage--dark_oUvU"></div></a><a class="navbar__item navbar__link" href="/docs/intro">ÊñáÊ°£</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/blog">ÂçöÂÆ¢</a><a class="navbar__item navbar__link" href="/docs/UseCases/kubernetes">‰ΩøÁî®Âú∫ÊôØ</a></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a class="navbar__link" aria-haspopup="true" aria-expanded="false" role="button" href="/docs/intro">latest</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/docs/intro">latest</a></li><li><a class="dropdown__link" href="/docs/v0.3.0/intro">v0.3.0</a></li><li><a class="dropdown__link" href="/docs/v0.2.0/intro">v0.2.0</a></li><li><a class="dropdown__link" href="/docs/v0.1.1/intro">v0.1.1</a></li><li><a class="dropdown__link" href="/docs/v0.1.0/intro">v0.1.0</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link"><span><svg viewBox="0 0 24 24" width="20" height="20" aria-hidden="true" class="iconLanguage_dNtB"><path fill="currentColor" d="M12.87 15.07l-2.54-2.51.03-.03c1.74-1.94 2.98-4.17 3.71-6.53H17V4h-7V2H8v2H1v1.99h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12zm-2.62 7l1.62-4.33L19.12 17h-3.24z"></path></svg><span>‰∏≠Êñá</span></span></a><ul class="dropdown__menu"><li><a href="/en/blog/releasev030" target="_self" rel="noopener noreferrer" class="dropdown__link">English</a></li><li><a href="/blog/releasev030" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active">‰∏≠Êñá</a></li></ul></div><a href="https://github.com/database-mesh/pisanix" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_S7eR colorModeToggle_vKtC"><button class="clean-btn toggleButton_rCf9 toggleButtonDisabled_Pu9x" type="button" disabled="" title="ÂàáÊç¢ÊµÖËâ≤/ÊöóÈªëÊ®°ÂºèÔºàÂΩìÂâç‰∏∫ÊµÖËâ≤Ê®°ÂºèÔºâ" aria-label="ÂàáÊç¢ÊµÖËâ≤/ÊöóÈªëÊ®°ÂºèÔºàÂΩìÂâç‰∏∫ÊµÖËâ≤Ê®°ÂºèÔºâ"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_v35p"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_nQuB"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_a9qW thin-scrollbar" aria-label="ÊúÄËøëÂçöÊñáÂØºËà™"><div class="sidebarItemTitle_uKok margin-bottom--md">Recent posts</div><ul class="sidebarItemList_Kvuv"><li class="sidebarItem_CF0Q"><a aria-current="page" class="sidebarItemLink_miNk sidebarItemLinkActive_RRTD" href="/blog/releasev030">Pisanix v0.3.0 Released !</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/blog/releasev020">Pisanix v0.2.0 Released !</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/blog/releasev011">Pisanix v0.1.1 Released !</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/blog/greetings">Hello! Pisanix!</a></li></ul></nav></aside><main class="col col--7" itemscope="" itemtype="http://schema.org/Blog"><article itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h1 class="blogPostTitle_rzP5" itemprop="headline">Pisanix v0.3.0 Released !</h1><div class="blogPostData_Zg1s margin-vert--md"><time datetime="2022-09-29T00:00:00.000Z" itemprop="datePublished">2022Âπ¥9Êúà29Êó•</time> ¬∑ <!-- -->8 ÂàÜÈíüÈòÖËØª</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_FlmR"><div class="avatar margin-bottom--sm"><span class="avatar__photo-link avatar__photo"><a href="https://github.com/mlycore" target="_blank" rel="noopener noreferrer"><img class="image_o0gy" src="https://github.com/mlycore.png" alt="Maxwell Miao"></a></span><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://github.com/mlycore" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">Maxwell Miao</span></a></div><small class="avatar__subtitle" itemprop="description">Founder of Pisanix</small></div></div></div><div class="col col--6 authorCol_FlmR"><div class="avatar margin-bottom--sm"><span class="avatar__photo-link avatar__photo"><a href="https://github.com/xuanyuan300" target="_blank" rel="noopener noreferrer"><img class="image_o0gy" src="https://i.imgur.com/aQBGA3H_d.webp?maxwidth=760&amp;fidelity=grand" alt="Jiandong Wu"></a></span><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://github.com/xuanyuan300" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">Jiandong Wu</span></a></div><small class="avatar__subtitle" itemprop="description">Maintainer of Pisanix</small></div></div></div><div class="col col--6 authorCol_FlmR"><div class="avatar margin-bottom--sm"><span class="avatar__photo-link avatar__photo"><a href="https://github.com/wbtlb" target="_blank" rel="noopener noreferrer"><img class="image_o0gy" src="https://avatars.githubusercontent.com/u/12859337?s=400&amp;u=a7a03e467206e9b248b75fd57f681da7ce2caa34&amp;v=4" alt="Bo Wang"></a></span><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://github.com/wbtlb" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">Bo Wang</span></a></div><small class="avatar__subtitle" itemprop="description">Maintainer of Pisanix</small></div></div></div></div></header><div id="post-content" class="markdown" itemprop="articleBody"><blockquote><p>Database Mesh-oriented solutions for an easy-to-use, good-to-use, and practical user experience.</p></blockquote><p>Pisanix v0.3.0 is Released, Introducing Data Sharding Strategy!.</p><blockquote><p>Data sharding is an effective solution to deal with massive data storage and computation. Pisanix now provides data sharding governance capability based on the underlying database, allowing users to scale out computing and storage.</p></blockquote><p>Data sharding is an effective solution to deal with massive data storage and computation.</p><p>Pisanix, a database mesh solution sponsored by SphereEx, now provides data sharding governance capability based on the underlying database - allowing users to scale out computing and storage.</p><p>Starting from v0.3.0, Pisanix will gradually support data sharding, with this release supporting single database sharding.</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="introducing-data-sharding">Introducing data sharding<a class="hash-link" href="#introducing-data-sharding" title="Ê†áÈ¢òÁöÑÁõ¥Êé•ÈìæÊé•">‚Äã</a></h2><p>As shown in Figure 1 below, data sharding mainly consists of SQL parse, SQL rewriting, SQL route, SQL execution, and result merge.</p><img loading="lazy" src="/img/release-v030-1.png" width="600" length="600" class="img_E7b_"><p><strong>Concepts</strong></p><p><strong>SQL Parse</strong>: During the sharding process, once the request is received by Pisa-Proxy, it will first go through SQL Parser, and the SQL will be parsed into AST. </p><p><strong>SQL Rewriting</strong>: After parsing, Pisa-Proxy will rewrite the current SQL statement according to the sharding rules to generate the real SQL statement to be executed.</p><p><strong>SQL Route</strong>: Pisa-Proxy routes the rewritten SQL statements to the corresponding data source at the backend to execute the SQL statements according to the sharding rules. </p><p><strong>SQL Execution</strong>: Pisa-Proxy will rewrite the SQL statement and push it down to the back-end real database for execution. </p><p><strong>Result Merge</strong>: Pisa-Proxy merges the query results and returns them to the client.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="introducing-sql-rewriting">Introducing SQL Rewriting<a class="hash-link" href="#introducing-sql-rewriting" title="Ê†áÈ¢òÁöÑÁõ¥Êé•ÈìæÊé•">‚Äã</a></h3><p>SQL rewriting is a critical module in data sharding. Pisa-Proxy needs to rewrite the current SQL statement according to the sharding rules to generate the real SQL statement to be executed. SQL rewriting can be of the following types:</p><h4 class="anchor anchorWithStickyNavbar_mojV" id="identifier-rewriting">Identifier Rewriting<a class="hash-link" href="#identifier-rewriting" title="Ê†áÈ¢òÁöÑÁõ¥Êé•ÈìæÊé•">‚Äã</a></h4><p>Identifiers to be rewritten include table names, index names, and schema names.</p><p>Table name rewriting means the process of finding the location of a logical table in the original SQL and rewriting it to a real table. Table name rewriting is a typical scenario that requires parsing of SQL. For example, if the logical SQL is:</p><div class="codeBlockContainer_I0IT language-SQL theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-SQL codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">SELECT order_id FROM order.t_order WHERE order_id = 1;</span><br></span></code></pre><button type="button" aria-label="Â§çÂà∂‰ª£Á†ÅÂà∞Ââ™Ë¥¥Êùø" title="Â§çÂà∂" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><p>Suppose that the shard key of this table is <code>order_id</code> and <code>order_id=1</code>, and the number of sharding is specified as two, then the SQL statement would be as follows:</p><div class="codeBlockContainer_I0IT language-SQL theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-SQL codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">SELECT order_id FROM order.t_order_00001 WHERE order_id = 1;</span><br></span></code></pre><button type="button" aria-label="Â§çÂà∂‰ª£Á†ÅÂà∞Ââ™Ë¥¥Êùø" title="Â§çÂà∂" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><p>The following figure shows the data query process:</p><img loading="lazy" src="/img/release-v030-2.png" width="600" length="600" class="img_E7b_"><p>Taking data writing as an example, the data insertion process is as follows:</p><img loading="lazy" src="/img/release-v030-3.png" width="600" length="600" class="img_E7b_"><p><strong>Note:</strong> When the SQL rewriting process modifies the identifier to calculate the real table name, it will automatically add the table index according to the sharding rule. The index rule is table name_index, and the index bit is five. For example, the t_order table is overwritten to t_order_00000. Therefore, you need to create the corresponding table name based on the actual business scenario.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="column-supplement-rewriting">Column Supplement Rewriting<a class="hash-link" href="#column-supplement-rewriting" title="Ê†áÈ¢òÁöÑÁõ¥Êé•ÈìæÊé•">‚Äã</a></h3><p>There are two cases that need supplement columns in a query statement. In the first case, Pisa-Proxy needs to get the data during the result merge, but the data is not returned by the queried SQL.</p><p>In this case, it mainly applies to GROUP BY and ORDER BY. When merging the results, you need to group and order the field items according to GROUP BY and ORDER BY, but if the original SQL does not contain grouping or ordering items in the selections, you need to rewrite the original SQL.</p><p>For instance, with an instance with the following SQL statement:</p><div class="codeBlockContainer_I0IT language-SQL theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-SQL codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">SELECT order_id, user_id FROM t_order ORDER BY user_id;</span><br></span></code></pre><button type="button" aria-label="Â§çÂà∂‰ª£Á†ÅÂà∞Ââ™Ë¥¥Êùø" title="Â§çÂà∂" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><p>Since user_id is used for sorting, the data of user_id needs to be retrieved in the result merge, the above SQL statement contains the data of user_id, so there is no need to add columns, and modifying the identifier is enough.</p><div class="codeBlockContainer_I0IT language-SQL theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-SQL codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">SELECT order_id FROM t_order ORDER BY user_id;</span><br></span></code></pre><button type="button" aria-label="Â§çÂà∂‰ª£Á†ÅÂà∞Ââ™Ë¥¥Êùø" title="Â§çÂà∂" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><p>This SQL depends on the user_id for sorting. Therefore, the column must be supplemented. The rewritten SQL is as follows:</p><div class="codeBlockContainer_I0IT language-SQL theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-SQL codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">SELECT order_id, user_id AS USER_ID_ORDER_BY_DERIVED_00000 FROM t_order_00000 ORDER BY user_id;</span><br></span></code></pre><button type="button" aria-label="Â§çÂà∂‰ª£Á†ÅÂà∞Ââ™Ë¥¥Êùø" title="Â§çÂà∂" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><p>The second case of column supplement is the use of AVG aggregate functions.</p><p>In distributed scenarios, using (avg1 + avg2 + avg3)/3 to calculate the average is incorrect and should be rewritten as (sum1 + sum2 + sum3) /(count1 + count2 + count3).</p><p>In this case, rewriting the SQL containing AVG to SUM and COUNT is required, and recalculating the average when the results are merged. For example:</p><div class="codeBlockContainer_I0IT language-SQL theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-SQL codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">SELECT AVG(price) FROM t_order WHERE user_id = 1;</span><br></span></code></pre><button type="button" aria-label="Â§çÂà∂‰ª£Á†ÅÂà∞Ââ™Ë¥¥Êùø" title="Â§çÂà∂" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><p>The rewritten SQL is as follows:</p><div class="codeBlockContainer_I0IT language-SQL theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-SQL codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">SELECT COUNT(price) AS AVG_DERIVED_COUNT_00000, SUM(price) AS AVG_DERIVED_SUM_00000 FROM t_order_00000 WHERE user_id = 1;</span><br></span></code></pre><button type="button" aria-label="Â§çÂà∂‰ª£Á†ÅÂà∞Ââ™Ë¥¥Êùø" title="Â§çÂà∂" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><h3 class="anchor anchorWithStickyNavbar_mojV" id="configuration-description">Configuration Description<a class="hash-link" href="#configuration-description" title="Ê†áÈ¢òÁöÑÁõ¥Êé•ÈìæÊé•">‚Äã</a></h3><p>This release supports query, update, deletion, and modification of the single database sharding based on a single shard key. The configuration items are as follows:</p><table><thead><tr><th align="center">Property</th><th align="center">Value Type</th><th align="center">Dependency or not</th><th align="center">Default Value</th><th align="center">Description</th></tr></thead><tbody><tr><td align="center">table_name</td><td align="center">String</td><td align="center">Yes</td><td align="center">No</td><td align="center">sharding table name</td></tr><tr><td align="center">actual_datanodes</td><td align="center">Array<!-- -->[String]</td><td align="center">Yes</td><td align="center">No</td><td align="center">backend data source</td></tr><tr><td align="center">table_sharding_algorithm_name</td><td align="center">Enum</td><td align="center">Yes</td><td align="center">No</td><td align="center">sharding algorithm(crc32mode and mod)</td></tr><tr><td align="center">table_sharding_column</td><td align="center">String</td><td align="center">Yes</td><td align="center">No</td><td align="center">shard key</td></tr><tr><td align="center">sharding_count</td><td align="center">u64</td><td align="center">Yes</td><td align="center">No</td><td align="center">number of sharding</td></tr></tbody></table><p><strong>Note</strong>: The broadcast table, binding table, sub-query, table sharding, distributed rules based on expressions, distributed transaction, and cross-database Join will be gradually supported in later versions.</p><p>Taking the scenario in Figure 2 and Figure 3 as an example, its corresponding CRD configuration is as follows:</p><div class="codeBlockContainer_I0IT language-Yaml theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-Yaml codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain"># Declare a VirtualDatabase as a logical database</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">apiVersion: core.database-mesh.io/v1alpha1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kind: VirtualDatabase</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">metadata:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  name: test</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  namespace: default</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">spec:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  services:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - databaseMySQL:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      db: test</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      host: 127.0.0.1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      password: &quot;root&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      port: 3306</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      user: root</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    name: mysql</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    trafficStrategy: test</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    dataShard: test</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">---</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Declare TrafficStrategy the specified proxy</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">apiVersion: core.database-mesh.io/v1alpha1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kind: TrafficStrategy</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">metadata:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  name: test</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  namespace: default</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">spec:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  loadBalance:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    simpleLoadBalance:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      kind: random</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  selector:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    matchLabels:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      source: test</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">---</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Declare DataShard the sharding rules</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">apiVersion: core.database-mesh.io/v1alpha1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kind: DataShard</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">metadata:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  name: test</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  namespace: default</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  labels:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    source: test</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">spec:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  rules:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - tableName: &quot;t_order&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    tableStrategy:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      tableShardingAlgorithmName: &quot;mod&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      tableShardingColumn: &quot;id&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      shardingCount: 2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    actualDatanodes:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      valueSource:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        nodes:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        - value: &quot;ds001&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">---</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Declare DatabaseEndpoint the identified physical database</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">apiVersion: core.database-mesh.io/v1alpha1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kind: DatabaseEndpoint</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">metadata:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  labels:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    source: test</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  name: ds001</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  namespace: default</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">spec:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  database:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    MySQL:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      db: test</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      host: mysql.default</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      password: root</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      port: 3306</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      user: root</span><br></span></code></pre><button type="button" aria-label="Â§çÂà∂‰ª£Á†ÅÂà∞Ââ™Ë¥¥Êùø" title="Â§çÂà∂" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><h2 class="anchor anchorWithStickyNavbar_mojV" id="pisanix-v030-overview">Pisanix v0.3.0 Overview<a class="hash-link" href="#pisanix-v030-overview" title="Ê†áÈ¢òÁöÑÁõ¥Êé•ÈìæÊé•">‚Äã</a></h2><p>This release has been made possible thanks to 102 merged PRs by the following contributors:</p><img loading="lazy" src="/img/release-v030-4.png" width="600" length="600" class="img_E7b_"><ul><li>New Features<ul><li>Pisa-Controller<ul><li>Support DataShard CRD #326</li></ul></li><li>Pisa-Proxy<ul><li>Support single database sharding #338</li></ul></li></ul></li><li>Enhancements<ul><li>Pisa-Controller<ul><li>Optimized Sidecar injection #234</li><li>Support generic static read/write splitting rule #251</li></ul></li><li>Pisa-Proxy<ul><li>Support SHOW STATUS parser #254</li><li>Introduce CloudWatch Sinker for later audit events #258</li><li>Support CREATE TABLESPACE parser #259</li><li>Support CREATE SERVER #261</li><li>Front MySQL protocol uses tokio codec #263</li><li>Support dynamic read/write splitting Monitor switch #264</li><li>Refactor MySQL server runtime #274</li><li>Experimental SIMD in SQL Parser #278</li></ul></li></ul></li><li>Fixes<ul><li>Pisa-Proxy<ul><li>Fix Apple M1 Macbook build failure in some cases #260</li><li>Fix malformed SQL format in some cases #291</li><li>Fix abnormal SQL parsing issues #297</li><li>Fix unexpected AST in some cases #301</li><li>Fix Pisa-Proxy crash without receiving VirtualDatabase configuration #319</li></ul></li></ul></li><li>Others<ul><li>Golang-SDK<ul><li>Move CRD and kubernetes client to github.com/database-mesh/golang-sdk #247</li><li>Add DataShard CRD and update VirtualDatabase with DataShard as new spec member in Golang-SDK</li></ul></li><li>Docs<ul><li>Add sharding doc: <a href="https://www.pisanix.io/docs/Features/sharding" target="_blank" rel="noopener noreferrer">https://www.pisanix.io/docs/Features/sharding</a></li><li>Optimized microservices-demo deployment instruction #318</li><li>Fork and optimize the code and configuration of github.com/microservices-demo/microservices-demo for a better demo. See: github.com/database-mesh/microservices-demo</li></ul></li><li>Charts<ul><li>Update controller and proxy mirror to v0.3.0</li></ul></li><li>Known Issues<ul><li>DO NOT support SHOW DATABASES and SHOW TABLES</li><li>DO NOT support observability under sharding mode</li></ul></li></ul></li></ul><h2 class="anchor anchorWithStickyNavbar_mojV" id="community">Community<a class="hash-link" href="#community" title="Ê†áÈ¢òÁöÑÁõ¥Êé•ÈìæÊé•">‚Äã</a></h2><img loading="lazy" src="/img/release-v030-5.png" width="600" length="600" class="img_E7b_"><p><strong>Pisanix is an open source implementation of Database Mesh. It builds unified database governance based on Rust, and aims at providing four major development and application experiences: local database, unified configuration management, multi-protocol support, and cloud-native architecture.</strong></p><p>The community is currently collecting more user scenarios and applications. If you&#x27;ve started or are planning to test Pisanix, please record it in the issue below.</p><p><a href="https://github.com/database-mesh/pisanix/issues/282" target="_blank" rel="noopener noreferrer">https://github.com/database-mesh/pisanix/issues/282</a></p><p>The community will prioritize the development and optimization of features related to real scenarios.</p><img loading="lazy" src="/img/release-v030-6.png" width="600" length="600" class="img_E7b_"><p>üîóDownload link: <a href="https://github.com/database-mesh/pisanix/releases/tag/v0.3.0" target="_blank" rel="noopener noreferrer">https://github.com/database-mesh/pisanix/releases/tag/v0.3.0</a></p><h2 class="anchor anchorWithStickyNavbar_mojV" id="community-call">Community Call<a class="hash-link" href="#community-call" title="Ê†áÈ¢òÁöÑÁõ¥Êé•ÈìæÊé•">‚Äã</a></h2><p>Building an open source community needs help from everywhere, no matter it&#x27;s code or documentation, issues or pull requests, community thanks all of your efforts.</p><p>At present, there are some ways to join the community:</p><table><thead><tr><th align="left"></th><th align="left"></th></tr></thead><tbody><tr><td align="left">Mailing List</td><td align="left"><a href="https://groups.google.com/g/database-mesh" target="_blank" rel="noopener noreferrer">https://groups.google.com/g/database-mesh</a></td></tr><tr><td align="left">Dev Meetings (Starting Feb 16th, 2022), Bi-weekly Wednesday 9:00AM PST</td><td align="left"><a href="https://meet.google.com/yhv-zrby-pyt" target="_blank" rel="noopener noreferrer">https://meet.google.com/yhv-zrby-pyt</a></td></tr><tr><td align="left">Dev Meetings APAC Friendly (Starting April 27th, 2022), Bi-weekly APAC Wednesday 9:00PM GMT+8</td><td align="left"><a href="https://meeting.tencent.com/dm/6UXDMNsHBVQO" target="_blank" rel="noopener noreferrer">https://meeting.tencent.com/dm/6UXDMNsHBVQO</a></td></tr><tr><td align="left">Wechat Broker</td><td align="left">pisanix</td></tr><tr><td align="left">Slack</td><td align="left"><a href="https://join.slack.com/t/databasemesh/shared_invite/zt-19rhvnxkz-USjZ~am~ghd_Q0q~8bAJXA" target="_blank" rel="noopener noreferrer">https://join.slack.com/t/databasemesh/shared_invite/zt-19rhvnxkz-USjZ~am~ghd_Q0q~8bAJXA</a></td></tr><tr><td align="left">Meetings Notes</td><td align="left"><a href="https://bit.ly/39Fqt3x" target="_blank" rel="noopener noreferrer">https://bit.ly/39Fqt3x</a></td></tr></tbody></table><p>Feel free to talk !</p></div><footer class="row docusaurus-mt-lg blogPostDetailsFull_h6_j"><div class="col"><b>Ê†áÁ≠æÔºö</b><ul class="tags_XVD_ padding--none margin-left--sm"><li class="tag_JSN8"><a class="tag_hD8n tagRegular_D6E_" href="/blog/tags/pisanix">pisanix</a></li><li class="tag_JSN8"><a class="tag_hD8n tagRegular_D6E_" href="/blog/tags/v-0-3-0">v0.3.0</a></li></ul></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="ÂçöÊñáÂàÜÈ°µÂØºËà™"><div class="pagination-nav__item"></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/blog/releasev020"><div class="pagination-nav__sublabel">ËæÉÊóß‰∏ÄÁØá</div><div class="pagination-nav__label">Pisanix v0.2.0 Released !</div></a></div></nav></main><div class="col col--2"><div class="tableOfContents_cNA8 thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#introducing-data-sharding" class="table-of-contents__link toc-highlight">Introducing data sharding</a><ul><li><a href="#introducing-sql-rewriting" class="table-of-contents__link toc-highlight">Introducing SQL Rewriting</a></li><li><a href="#column-supplement-rewriting" class="table-of-contents__link toc-highlight">Column Supplement Rewriting</a></li><li><a href="#configuration-description" class="table-of-contents__link toc-highlight">Configuration Description</a></li></ul></li><li><a href="#pisanix-v030-overview" class="table-of-contents__link toc-highlight">Pisanix v0.3.0 Overview</a></li><li><a href="#community" class="table-of-contents__link toc-highlight">Community</a></li><li><a href="#community-call" class="table-of-contents__link toc-highlight">Community Call</a></li></ul></div></div></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/docs/intro">ÊñáÊ°£</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/quickstart">Âø´ÈÄüÂºÄÂßã</a></li></ul></div><div class="col footer__col"><div class="footer__title">Á§æÂå∫</div><ul class="footer__items"><li class="footer__item"><a href="https://twitter.com/maxwell9215" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://databasemesh.slack.com/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Slack<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">Êõ¥Â§ö</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/blog">ÂçöÂÆ¢</a></li><li class="footer__item"><a href="https://github.com/database-mesh/pisanix" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright ¬© 2022 SphereEx Authors. Built with Docusaurus.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.04f15e4e.js"></script>
<script src="/assets/js/main.0d539512.js"></script>
</body>
</html>